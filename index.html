<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>WordMaster Pro</title>
    <style>
        :root { --bg: #121212; --card: #1e1e1e; --primary: #bb86fc; --text: #e0e0e0; --sub: #a0a0a0; }
        body { font-family: -apple-system, sans-serif; margin: 0; background: var(--bg); color: var(--text); padding-bottom: env(safe-area-inset-bottom); }
        
        /* é ‚éƒ¨å°è¦½ */
        .app-bar { position: sticky; top: 0; background: rgba(18,18,18,0.9); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); padding: 15px; z-index: 1000; border-bottom: 1px solid #333; }
        .menu-btn { background: var(--primary); color: #000; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; margin-bottom: 10px; }
        .toggle-btn { background: #2c2c2c; color: var(--primary); border: 1px solid #444; padding: 8px 15px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 48%; margin-bottom: 10px; }
        .btn-row { display: flex; gap: 4%; margin-bottom: 10px; }
        .search-input { background: #2c2c2c; border: 1px solid #444; border-radius: 10px; padding: 10px; width: 100%; color: white; box-sizing: border-box; outline: none; }

        /* å…¨è¢å¹•ä¸‰å±¤é¸å–® */
        .menu-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 2000; display: none; flex-direction: column; align-items: center; padding: 40px 20px; overflow-y: auto; }
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; width: 100%; max-width: 400px; }
        .grid-item { background: #333; color: var(--primary); height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 10px; font-weight: bold; cursor: pointer; text-decoration: none; }
        .active-mode { border: 2px solid var(--primary); background: #444; }

        /* å–®å­—å¡ç‰‡ */
        .content { padding: 15px; }
        .word-card { background: var(--card); border-radius: 12px; padding: 18px; margin-bottom: 12px; position: relative; border-left: 4px solid #333; }
        .word-card.mastered { border-left-color: #03dac6; }
        .word-title { font-size: 24px; font-weight: bold; color: var(--primary); cursor: pointer; }
        .word-title.masked { filter: blur(12px); background: #333; color: transparent; border-radius: 4px; }
        .star { position: absolute; top: 18px; right: 18px; color: #555; font-size: 20px; }
        .star.active { color: #f1c40f; }
        .divider { font-size: 28px; font-weight: 900; color: #444; margin: 30px 0 10px; border-bottom: 2px solid #333; }
    </style>
</head>
<body>

<div class="menu-overlay" id="menuOverlay">
    <div style="color:white; margin-bottom:20px; font-weight:bold;" id="navStep">ç¬¬ä¸€å±¤ï¼šå­¸ç¿’ç‹€æ…‹</div>
    <div id="modeSection" class="grid" style="grid-template-columns: repeat(3, 1fr); margin-bottom:30px; width:100%;">
        <div class="grid-item active-mode" id="m-all" onclick="setMode('all')">å…¨éƒ¨</div>
        <div class="grid-item" id="m-1" onclick="setMode('1')">å·²ç†Ÿ</div>
        <div class="grid-item" id="m-0" onclick="setMode('0')">æœªç†Ÿ</div>
    </div>
    <div id="menuGrid" class="grid"></div>
    <button onclick="toggleMenu(false)" style="margin-top:30px; background:none; border:1px solid white; color:white; padding:10px 30px; border-radius:20px;">é—œé–‰</button>
</div>

<div class="app-bar">
    <button class="menu-btn" onclick="openL1()">â˜° é–‹å•Ÿä¸‰å±¤é¸å–®ç›®éŒ„</button>
    <div class="btn-row">
        <button class="toggle-btn" onclick="toggleAllWords(true)">ğŸ™ˆ é®ä½å…¨éƒ¨</button>
        <button class="toggle-btn" onclick="toggleAllWords(false)">ğŸ‘ï¸ é¡¯ç¤ºå…¨éƒ¨</button>
    </div>
    <input type="text" id="searchInput" class="search-input" placeholder="æœå°‹å–®å­—ã€ä¸­æ–‡...">
</div>

<main class="content" id="listBody"></main>

<script>
    const SHEET_CSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQvabePqyogTjHeINnBYyZWK6uQpJikumzN__QbAg7Z38CurIlE8LYapPUuayBwgYH_hQuMcQ0ir0Ym/pub?output=csv';
    let wordDB = [];
    let currentMode = 'all'; // all, 1 (mastered), 0 (learning)

    async function init() {
        try {
            const res = await fetch(SHEET_CSV);
            const csv = await res.text();
            const rows = csv.split(/\r?\n/).slice(1);
            wordDB = rows.map(r => {
                const p = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                return { 
                    w: p[0]?.replace(/"/g,'').trim() || '', 
                    p: p[1]?.replace(/"/g,'').trim() || '', 
                    d: p[2]?.replace(/"/g,'').trim() || '', 
                    u: p[3]?.replace(/"/g,'').trim() || '', 
                    s: p[4]?.replace(/"/g,'').trim() || '' 
                };
            }).filter(i => i.w);
            render();
        } catch (e) { alert('åŒæ­¥å¤±æ•—ï¼š' + e.message); }
    }

    function render(filterData = null) {
        const data = filterData || wordDB;
        const sortedData = [...data].sort((a, b) => a.w.localeCompare(b.w));
        let html = '';
        let addedDividers = new Set();
        
        sortedData.forEach(item => {
            if (currentMode !== 'all' && item.s !== currentMode && !(currentMode === '0' && item.s === '')) return;
            const l2 = item.w.substring(0, 2).toUpperCase();
            if (!addedDividers.has(l2)) {
                html += `<div class="divider" id="idx-${l2}">${l2}</div>`;
                addedDividers.add(l2);
            }
            html += `
                <div class="word-card ${item.s==='1'?'mastered':''}">
                    <span class="star ${item.s==='1'?'active':''}">â˜…</span>
                    <div class="word-title" onclick="this.classList.toggle('masked')">${item.w}</div>
                    <div style="margin-top:8px;">${item.d}</div>
                    <div style="color:var(--sub); font-size:13px; margin-top:5px;">${item.p || ''}</div>
                </div>`;
        });
        document.getElementById('listBody').innerHTML = html || '<div style="text-align:center; color:var(--sub); padding:40px;">ç„¡ç¬¦åˆçš„å–®å­—</div>';
    }

    function setMode(m) {
        currentMode = m;
        document.querySelectorAll('#modeSection .grid-item').forEach(el => el.classList.remove('active-mode'));
        document.getElementById(`m-${m}`).classList.add('active-mode');
        updateL2Menu();
    }

    function updateL2Menu() {
        document.getElementById('navStep').innerText = "ç¬¬äºŒå±¤ï¼šé¸æ“‡ A-Z";
        const letters = new Set();
        wordDB.forEach(i => {
            if (i.w && (currentMode === 'all' || i.s === currentMode || (currentMode === '0' && i.s === ''))) {
                letters.add(i.w[0].toUpperCase());
            }
        });
        document.getElementById('menuGrid').innerHTML = Array.from(letters).sort().map(l => `<div class="grid-item" onclick="openL2('${l}')">${l}</div>`).join('');
    }

    function openL1() {
        updateL2Menu();
        toggleMenu(true);
    }

    function openL2(l1) {
        document.getElementById('navStep').innerText = `ç¬¬ä¸‰å±¤ï¼š${l1} é–‹é ­çµ„åˆ`;
        const subs = new Set();
        wordDB.forEach(i => {
            if (i.w && i.w[0].toUpperCase() === l1 && (currentMode === 'all' || i.s === currentMode || (currentMode === '0' && i.s === ''))) {
                subs.add(i.w.substring(0, 2).toUpperCase());
            }
        });
        let html = `<div class="grid-item" style="background:#444" onclick="openL1()">â† è¿”å›</div>`;
        html += Array.from(subs).sort().map(s => `<div class="grid-item" onclick="jumpToSection('${s}')">${s}</div>`).join('');
        document.getElementById('menuGrid').innerHTML = html;
    }

    function jumpToSection(prefix) {
        toggleMenu(false);
        render();
        setTimeout(() => {
            const target = document.getElementById(`idx-${prefix}`);
            if (target) {
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }, 100);
    }

    function toggleMenu(s) { document.getElementById('menuOverlay').style.display = s ? 'flex' : 'none'; }

    function toggleAllWords(mask) {
        const allTitles = document.querySelectorAll('.word-title');
        allTitles.forEach(title => {
            if (mask) {
                title.classList.add('masked');
            } else {
                title.classList.remove('masked');
            }
        });
    }

    document.getElementById('searchInput').addEventListener('input', (e) => {
        const q = e.target.value.toLowerCase();
        const f = wordDB.filter(i => i.w.toLowerCase().includes(q) || i.d.includes(q));
        render(f);
    });

    init();
</script>
</body>
</html>
